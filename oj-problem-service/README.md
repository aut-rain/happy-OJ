## è®¾è®¡æ€è·¯



> ### è®¾è®¡æµç¨‹
>
> 
>
> 1. #### æ•°æ®åº“å­—æ®µè®¾è®¡
>
>    **æˆ‘æƒ³è¦è®¾è®¡OJç½‘ç«™çš„é¢˜åº“åŠŸèƒ½,ç°åœ¨åœ¨è®¾è®¡æ•°æ®åº“**
>
>    **æ¯ä¸ªé¢˜ç›®è¦æœ‰é¢˜ç›®ç¼–å·(id),é¢˜ç›®çš„æ ‡ç­¾(ä¸æ­¢ä¸€ä¸ª),é¢˜ç›®åç§°,é¢˜ç›®éš¾æ˜“ç¨‹åº¦,é¢˜ç›®åšé¢˜æ•°,é¢˜ç›®é€šè¿‡ç‡,é¢˜ç›®çš„mdæ–‡æ¡£é“¾æ¥(md_url),é¢˜ç›®çš„éªŒè¯è¾“å…¥æ–‡ä»¶é“¾æ¥(in_url),é¢˜ç›®çš„éªŒè¯è¾“å‡ºæ–‡ä»¶çš„é“¾æ¥(out_url),å½“å‰ç”¨æˆ·çš„åšé¢˜æƒ…å†µ(å°è¯•è¿‡/æ²¡æœ‰å°è¯•è¿‡/é€šè¿‡),é¢˜ç›®çš„ç­”æ¡ˆæ–‡ä»¶çš„é“¾æ¥(id_uid_answer_url,ä¸€ä¸ªé¢˜ç›®ä¸æ­¢ä¸€ä¸ªç­”æ¡ˆ)...**
>
>    
>
> 2. #### æµç¨‹è®¾è®¡
>
>    **2.1 é¢˜åº“å±•ç¤ºçš„å†…å®¹åªæœ‰ç¼–å·,é¢˜ç›®åç§°,æ ‡ç­¾,éš¾æ˜“ç¨‹åº¦,æäº¤æ•°,é€šè¿‡ç‡ **
>
>    **2.2 é¢˜ç›®çš„mdæ–‡æ¡£éœ€è¦ç‚¹å‡»é¢˜ç›®åæ‰èƒ½çœ‹åˆ°**
>
>    **2.3 é¢˜ç›®çš„ç­”æ¡ˆä¹Ÿå¿…é¡»ç‚¹å‡»é¢˜ç›®ååœ¨é¢˜ç›®é¡µé¢çš„ä¾§è¾¹æ å¤„æœ‰ä¸ªç­”æ¡ˆé¡µé¢ç‚¹å‡»æ‰èƒ½çœ‹åˆ°è¯¥é¢˜çš„ç­”æ¡ˆ**
>
>    **2.4 æ ‡å‡†è¾“å…¥æ–‡ä»¶é“¾æ¥å’Œæ ‡å‡†è¾“å‡ºæ–‡ä»¶é“¾æ¥éœ€è¦ç”¨æˆ·ç‚¹å‡»æäº¤ååç«¯æ‰èƒ½è¿›è¡Œ**
>
>    **2.5 ç”¨æˆ·é€‰æ‹©ä»£ç è¯­è¨€ç„¶åæäº¤ä»£ç åå¯ä»¥æ˜¾ç¤ºé€šè¿‡ç»“æœ(å•ä¸ªæµ‹è¯•ç»“æœé€šè¿‡çŠ¶å†µaccept/wrong/exception...,å•ä¸ªæµ‹è¯•ç»“æœè€—æ—¶,å…¨éƒ¨æµ‹è¯•ç»“æœæ˜¯å¦å…¨å¯¹))**
>
>    **2.6 ç”¨æˆ·å¯ä»¥çœ‹åˆ°è‡ªå·±çš„å†å²æäº¤è®°å½•(åŒ…æ‹¬æäº¤çš„ä»£ç ,ä»¥åŠé€šè¿‡æƒ…å†µ)**
>
>    **æš‚æ—¶æˆ‘å°±æƒ³åˆ°è¿™äº›,éœ€è¦ç»“åˆå­—æ®µçš„æŸ¥æ‰¾å’Œæ”¹åŠ¨é¢‘ç‡ä»¥åŠæ•°æ®åº“è¡¨è®¾è®¡è§„èŒƒè¿˜æœ‰é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œä¸­çš„æ•°æ®åº“è®¾è®¡è§„èŒƒ,è¿›è¡Œåˆ†æå¦‚ä½•è¿›è¡Œæ•°æ®åº“è¡¨çš„è®¾è®¡,ä»¥åŠå­—æ®µåçš„å‘½å**





## ä¸€ã€ä¸šåŠ¡æµç¨‹æ¢³ç†

| é˜¶æ®µ        | ç”¨æˆ·è¡Œä¸º                                                     | åç«¯å“åº”                                  |
| ----------- | ------------------------------------------------------------ | ----------------------------------------- |
| 1. é¢˜åº“åˆ—è¡¨ | æµè§ˆé¢˜ç›®ï¼šç¼–å·ã€åç§°ã€æ ‡ç­¾ã€éš¾åº¦ã€æäº¤æ•°ã€é€šè¿‡ç‡             | æŸ¥è¯¢ `problem` + `problem_tag` + `tag`    |
| 2. é¢˜ç›®è¯¦æƒ… | ç‚¹å‡»é¢˜ç›® â†’ æŸ¥çœ‹é¢˜ç›®æè¿°ï¼ˆmdï¼‰ã€ä¾§è¾¹æ â€œæŸ¥çœ‹ç­”æ¡ˆâ€              | æŸ¥è¯¢ `problem.md_url`ï¼Œ**ç­”æ¡ˆéœ€æƒé™æ§åˆ¶** |
| 3. æäº¤ä»£ç  | é€‰æ‹©è¯­è¨€ â†’ æäº¤ä»£ç  â†’ åç«¯è·å– `in_url` / `out_url` è¿›è¡Œåˆ¤é¢˜ | ç”Ÿæˆ `submission` è®°å½•ï¼Œè°ƒç”¨åˆ¤é¢˜æœåŠ¡      |
| 4. æŸ¥çœ‹ç»“æœ | æ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•ç‚¹ç»“æœï¼ˆé€šè¿‡/é”™è¯¯/è¶…æ—¶ï¼‰ã€è€—æ—¶ã€å†…å­˜ã€æ€»ç»“æœ     | å­˜å‚¨åœ¨ `submission_detail` è¡¨             |
| 5. æŸ¥çœ‹å†å² | æŸ¥çœ‹è‡ªå·±å¯¹è¯¥é¢˜çš„æ‰€æœ‰æäº¤è®°å½•ï¼ˆä»£ç ã€çŠ¶æ€ã€æ—¶é—´ï¼‰             | æŸ¥è¯¢ `submission` + `submission_detail`   |



## äºŒã€æ•°æ®åº“è¡¨è®¾è®¡ä¼˜åŒ–

### 1. é¢˜ç›®è¡¨ï¼š`problem` 

```
create table problem (
    id bigint unsigned primary key auto_increment,
    title varchar(255) not null,
    difficulty tinyint not null comment '1:ç®€å•, 2:ä¸­ç­‰, 3:å›°éš¾',
    md_url varchar(512) not null,
    in_url varchar(512) not null,
    out_url varchar(512) not null,
    submit_count int unsigned not null default 0,
    accept_count int unsigned not null default 0,
    pass_rate decimal(5,2) not null default 0.00,
    status tinyint not null default 1,
    create_time datetime not null,
    update_time datetime not null
) engine=innodb default charset=utf8mb4;
```

| å­—æ®µå         | ç±»å‹            | å¿…å¡«              | è¯´æ˜                             |
| -------------- | --------------- | ----------------- | -------------------------------- |
| `id`           | BIGINT UNSIGNED | YES               | é¢˜ç›®å”¯ä¸€IDï¼Œè‡ªå¢ä¸»é”®             |
| `title`        | VARCHAR(255)    | YES               | é¢˜ç›®åç§°                         |
| `difficulty`   | TINYINT         | YES               | éš¾åº¦ç­‰çº§ï¼š1-ç®€å•ï¼Œ2-ä¸­ç­‰ï¼Œ3-å›°éš¾ |
| `md_url`       | VARCHAR(512)    | YES               | Markdowné¢˜ç›®æè¿°æ–‡ä»¶é“¾æ¥         |
| `in_url`       | VARCHAR(512)    | YES               | æ ‡å‡†è¾“å…¥æ–‡ä»¶é“¾æ¥ï¼ˆç”¨äºåˆ¤é¢˜ï¼‰     |
| `out_url`      | VARCHAR(512)    | YES               | æ ‡å‡†è¾“å‡ºæ–‡ä»¶é“¾æ¥ï¼ˆç”¨äºåˆ¤é¢˜ï¼‰     |
| `submit_count` | INT UNSIGNED    | YES, DEFAULT 0    | æ€»æäº¤æ¬¡æ•°                       |
| `accept_count` | INT UNSIGNED    | YES, DEFAULT 0    | é€šè¿‡æ¬¡æ•°                         |
| `pass_rate`    | DECIMAL(5,2)    | YES, DEFAULT 0.00 | é€šè¿‡ç‡ï¼ˆå¯è®¡ç®—ï¼Œç¼“å­˜æå‡æ€§èƒ½ï¼‰   |
| `status`       | TINYINT         | YES, DEFAULT 1    | çŠ¶æ€ï¼š1-æ­£å¸¸ï¼Œ0-ä¸‹çº¿ï¼Œ2-å¾…å®¡æ ¸   |
| `create_time`  | DATETIME        | YES               | åˆ›å»ºæ—¶é—´                         |
| `update_time`  | DATETIME        | YES               | æ›´æ–°æ—¶é—´                         |

| å­—æ®µ                                                         | è¯´æ˜                     |
| ------------------------------------------------------------ | ------------------------ |
| `id`, `title`, `difficulty`, `submit_count`, `accept_count`, `pass_rate` | åˆ—è¡¨é¡µç›´æ¥å±•ç¤º           |
| `md_url`                                                     | é¢˜ç›®æè¿°æ–‡ä»¶ï¼Œç‚¹å‡»ååŠ è½½ |
| `status`                                                     | æ§åˆ¶é¢˜ç›®æ˜¯å¦å¯è§         |

> ğŸ“Œ **æ³¨æ„**ï¼š`in_url`, `out_url` ä¿ç•™åœ¨ `problem` è¡¨ä¸­ï¼Œä½†**ä»…åç«¯åˆ¤é¢˜æœåŠ¡å¯è®¿é—®**ï¼Œå‰ç«¯ä¸å¯è§ã€‚

### 2. é¢˜ç›®æ ‡ç­¾å…³è”è¡¨ï¼š`problem_tag` 

ç”¨äºå¤šå¯¹å¤šå…³è”é¢˜ç›®å’Œæ ‡ç­¾ã€‚

```
CREATE TABLE problem_tag (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    problem_id BIGINT UNSIGNED NOT NULL,
    tag_id BIGINT UNSIGNED NOT NULL,
    create_time DATETIME NOT NULL,
    UNIQUE KEY uk_problem_tag (problem_id, tag_id),
    KEY idx_problem_id (problem_id),
    KEY idx_tag_id (tag_id)
);
```

| å­—æ®µå        | ç±»å‹            | å¿…å¡« | è¯´æ˜     |
| ------------- | --------------- | ---- | -------- |
| `id`          | BIGINT UNSIGNED | YES  | ä¸»é”®     |
| `problem_id`  | BIGINT UNSIGNED | YES  | é¢˜ç›®ID   |
| `tag_id`      | BIGINT UNSIGNED | YES  | æ ‡ç­¾ID   |
| `create_time` | DATETIME        | YES  | åˆ›å»ºæ—¶é—´ |

### 3. æ ‡ç­¾è¡¨ï¼š`tag`

```
CREATE TABLE tag (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(64) NOT NULL UNIQUE,
    description VARCHAR(255),
    status TINYINT NOT NULL DEFAULT 1,
    create_time DATETIME NOT NULL,
    update_time DATETIME NOT NULL
);
```

| å­—æ®µå        | ç±»å‹            | å¿…å¡« | è¯´æ˜                          |
| ------------- | --------------- | ---- | ----------------------------- |
| `id`          | BIGINT UNSIGNED | YES  | ä¸»é”®                          |
| `name`        | VARCHAR(64)     | YES  | æ ‡ç­¾åï¼Œå¦‚ "æ•°ç»„", "åŠ¨æ€è§„åˆ’" |
| `description` | VARCHAR(255)    | NO   | æè¿°                          |
| `status`      | TINYINT         | YES  | çŠ¶æ€                          |
| `create_time` | DATETIME        | YES  | åˆ›å»ºæ—¶é—´                      |
| `update_time` | DATETIME        | YES  | æ›´æ–°æ—¶é—´                      |

### 4. ç”¨æˆ·æäº¤è®°å½•è¡¨ï¼š`submission` 

è®°å½•æ¯æ¬¡æäº¤çš„åŸºæœ¬ä¿¡æ¯ã€‚

```
CREATE TABLE submission (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT UNSIGNED NOT NULL,
    problem_id BIGINT UNSIGNED NOT NULL,
    code_url VARCHAR(512) NOT NULL,
    language VARCHAR(32) NOT NULL,
    status TINYINT NOT NULL COMMENT '0:pending,1:accepted,2:wrong,3:timeout,4:compile_error...',
    submit_time DATETIME NOT NULL,
    run_time_ms INT UNSIGNED,
    memory_kb INT UNSIGNED,
    score INT UNSIGNED,
    KEY idx_user_id (user_id),
    KEY idx_problem_id (problem_id),
    KEY idx_user_problem (user_id, problem_id),
    KEY idx_submit_time (submit_time)
);
```

| å­—æ®µ          | è¯´æ˜                                                         |
| ------------- | ------------------------------------------------------------ |
| `id`          | æäº¤è®°å½•å”¯ä¸€ID                                               |
| `user_id`     | æäº¤ç”¨æˆ·                                                     |
| `problem_id`  | å¯¹åº”é¢˜ç›®                                                     |
| `code_url`    | ç”¨æˆ·æäº¤çš„ä»£ç æ–‡ä»¶é“¾æ¥ï¼ˆOSS/S3ï¼‰                             |
| `language`    | ç¼–ç¨‹è¯­è¨€ï¼ˆC++, Java, Pythonç­‰ï¼‰                              |
| `status`      | æ€»ä½“çŠ¶æ€ï¼š0-å¾…åˆ¤é¢˜ï¼Œ1-é€šè¿‡ï¼Œ2-ç­”æ¡ˆé”™è¯¯ï¼Œ3-è¶…æ—¶ï¼Œ4-ç¼–è¯‘é”™è¯¯ç­‰ |
| `submit_time` | æäº¤æ—¶é—´                                                     |
| `run_time_ms` | æœ€å¤§è¿è¡Œæ—¶é—´ï¼ˆmsï¼‰                                           |
| `memory_kb`   | æœ€å¤§å†…å­˜ä½¿ç”¨ï¼ˆKBï¼‰                                           |
| `score`       | å¾—åˆ†ï¼ˆ0~100ï¼‰                                                |

> ğŸ” `code_url` å­˜å‚¨ä»£ç å†…å®¹ï¼Œä»…ç”¨æˆ·è‡ªå·±å’Œç®¡ç†å‘˜å¯æŸ¥çœ‹ã€‚

### 5. æäº¤è¯¦æƒ…è¡¨ï¼š`submission_detail` 

ç”¨äºå­˜å‚¨æ¯ä¸ªæµ‹è¯•ç‚¹çš„åˆ¤é¢˜ç»“æœï¼Œæ”¯æŒç»†ç²’åº¦åé¦ˆã€‚

```
CREATE TABLE submission_detail (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    submission_id BIGINT UNSIGNED NOT NULL,
    test_case_name VARCHAR(64),
    status TINYINT NOT NULL,
    input_url VARCHAR(512),
    expected_output_url VARCHAR(512),
    actual_output_url VARCHAR(512),
    run_time_ms INT UNSIGNED,
    memory_kb INT UNSIGNED,
    order_index INT,
    KEY idx_submission_id (submission_id),
    KEY idx_status (status)
);
```

| å­—æ®µ                  | ç±»å‹            | è¯´æ˜                                       |
| --------------------- | --------------- | ------------------------------------------ |
| `id`                  | BIGINT UNSIGNED | ä¸»é”®                                       |
| `submission_id`       | BIGINT UNSIGNED | å¤–é”®ï¼Œå…³è” `submission.id`                 |
| `test_case_name`      | VARCHAR(64)     | æµ‹è¯•ç‚¹åç§°ï¼Œå¦‚ "test_1"                    |
| `status`              | TINYINT         | çŠ¶æ€ï¼š1-é€šè¿‡ï¼Œ2-é”™è¯¯ï¼Œ3-è¶…æ—¶ï¼Œ4-æ ¼å¼é”™è¯¯ç­‰ |
| `input_url`           | VARCHAR(512)    | è¾“å…¥æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œè°ƒè¯•ç”¨ï¼‰                   |
| `expected_output_url` | VARCHAR(512)    | æœŸæœ›è¾“å‡ºï¼ˆå¯é€‰ï¼‰                           |
| `actual_output_url`   | VARCHAR(512)    | å®é™…è¾“å‡ºï¼ˆåˆ¤é¢˜åç”Ÿæˆï¼‰                     |
| `run_time_ms`         | INT             | è¯¥æµ‹è¯•ç‚¹è€—æ—¶                               |
| `memory_kb`           | INT             | è¯¥æµ‹è¯•ç‚¹å†…å­˜                               |
| `order_index`         | INT             | æµ‹è¯•ç‚¹é¡ºåº                                 |

> ğŸ“Œ ç¤ºä¾‹ï¼šä¸€ä¸ªæäº¤æœ‰ 5 ä¸ªæµ‹è¯•ç‚¹ï¼Œ`submission_detail` ä¸­å°±æœ‰ 5 æ¡è®°å½•ã€‚

### 6. ç­”æ¡ˆè¡¨ï¼š`problem_answer` 

å­˜å‚¨é¢˜ç›®çš„å‚è€ƒç­”æ¡ˆï¼ˆæˆ–æ ‡å‡†è§£æ³•ï¼‰ï¼Œ**ä»…æˆæƒç”¨æˆ·ï¼ˆå¦‚é€šè¿‡è€…ï¼‰å¯æŸ¥çœ‹**ã€‚

```
CREATE TABLE problem_answer (
    id BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT,
    problem_id BIGINT UNSIGNED NOT NULL,
    answer_url VARCHAR(512) NOT NULL,
    language VARCHAR(32) NOT NULL,
    description TEXT,
    create_time DATETIME NOT NULL,
    UNIQUE KEY uk_problem_language (problem_id, language)
);
```

| å­—æ®µ          | ç±»å‹            | è¯´æ˜             |
| ------------- | --------------- | ---------------- |
| `id`          | BIGINT UNSIGNED | ä¸»é”®             |
| `problem_id`  | BIGINT UNSIGNED | å¤–é”®             |
| `answer_url`  | VARCHAR(512)    | ç­”æ¡ˆä»£ç æ–‡ä»¶é“¾æ¥ |
| `language`    | VARCHAR(32)     | ç­”æ¡ˆè¯­è¨€         |
| `description` | TEXT            | ç­”æ¡ˆè¯´æ˜ï¼ˆå¯é€‰ï¼‰ |
| `create_time` | DATETIME        | åˆ›å»ºæ—¶é—´         |

> ğŸ” å‰ç«¯â€œç­”æ¡ˆâ€æŒ‰é’®æ˜¯å¦æ˜¾ç¤ºï¼Œç”±åç«¯åˆ¤æ–­ï¼š`å½“å‰ç”¨æˆ·æ˜¯å¦å·²é€šè¿‡è¯¥é¢˜`ã€‚

> æ”¯æŒåŒä¸€é¢˜å¤šä¸ªè¯­è¨€çš„ç­”æ¡ˆã€‚

### 7. ï¼ˆå¯é€‰ï¼‰ç”¨æˆ·é¢˜ç›®çŠ¶æ€å¿«ç…§è¡¨ï¼š`user_problem_status` 

ç¼“å­˜ç”¨æˆ·å¯¹æ¯é“é¢˜çš„æœ€æ–°çŠ¶æ€ï¼Œç”¨äºå¿«é€Ÿå±•ç¤ºâ€œå·²é€šè¿‡â€ã€â€œå·²å°è¯•â€ã€‚

sqlæ·±è‰²ç‰ˆæœ¬

```
CREATE TABLE user_problem_status (
    user_id BIGINT UNSIGNED NOT NULL,
    problem_id BIGINT UNSIGNED NOT NULL,
    last_status TINYINT NOT NULL COMMENT '0:æœªå°è¯•,1:å°è¯•æœªè¿‡,2:å·²é€šè¿‡',
    last_submit_time DATETIME,
    submit_count INT UNSIGNED NOT NULL DEFAULT 1,
    update_time DATETIME NOT NULL,
    PRIMARY KEY (user_id, problem_id),
    KEY idx_last_status (last_status)
);
```

| å­—æ®µå             | ç±»å‹            | å¿…å¡«           | è¯´æ˜                                       |
| ------------------ | --------------- | -------------- | ------------------------------------------ |
| `user_id`          | BIGINT UNSIGNED | YES            | ç”¨æˆ·ID                                     |
| `problem_id`       | BIGINT UNSIGNED | YES            | é¢˜ç›®ID                                     |
| `last_status`      | TINYINT         | YES            | æœ€æ–°çŠ¶æ€ï¼š0-æœªå°è¯•ï¼Œ1-å°è¯•æœªé€šè¿‡ï¼Œ2-å·²é€šè¿‡ |
| `last_submit_time` | DATETIME        | NO             | æœ€åæäº¤æ—¶é—´                               |
| `submit_count`     | INT UNSIGNED    | YES, DEFAULT 1 | ç”¨æˆ·å¯¹æ­¤é¢˜æäº¤æ¬¡æ•°                         |
| `update_time`      | DATETIME        | YES            | æ›´æ–°æ—¶é—´                                   |

> ğŸ”— è”åˆä¸»é”®ï¼š`(user_id, problem_id)`
>  ğŸš€ ä¼˜åŠ¿ï¼šæŸ¥è¯¢â€œç”¨æˆ·åšè¿‡å“ªäº›é¢˜â€æå¿«ï¼Œé¿å…æ‰«æ `submission` å¤§è¡¨ã€‚
>  âš ï¸ éœ€åœ¨æ¯æ¬¡æäº¤åˆ¤é¢˜åå¼‚æ­¥æ›´æ–°æ­¤è¡¨ï¼ˆå¯ç”¨æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ï¼‰ã€‚

## ä¸‰ã€å­—æ®µå‘½åè§„èŒƒï¼ˆä¸¥æ ¼éµå¾ªé˜¿é‡Œè§„èŒƒï¼‰

| ç±»å‹     | è§„èŒƒ                            | ç¤ºä¾‹                            |
| -------- | ------------------------------- | ------------------------------- |
| è¡¨å     | å°å†™å•æ•°åè¯                    | `problem`, `submission`         |
| å­—æ®µå   | å°å†™ + ä¸‹åˆ’çº¿                   | `problem_id`, `submit_count`    |
| ä¸»é”®     | `id`                            | `BIGINT UNSIGNED`               |
| å¤–é”®     | `å…³è”è¡¨å_id`                   | `problem_id`, `user_id`         |
| ç´¢å¼•     | `idx_å­—æ®µ` æˆ– `uk_å­—æ®µ`ï¼ˆå”¯ä¸€ï¼‰ | `idx_user_id`, `uk_problem_tag` |
| æ—¶é—´å­—æ®µ | `create_time`, `update_time`    | ç»Ÿä¸€ä½¿ç”¨ `DATETIME`             |

------

## å››ã€å…³é”®ä¸šåŠ¡åœºæ™¯ SQL ç¤ºä¾‹

### 1. é¢˜åº“åˆ—è¡¨é¡µæŸ¥è¯¢ï¼ˆå¸¦æ ‡ç­¾ï¼‰

sqlæ·±è‰²ç‰ˆæœ¬

```
SELECT 
    p.id, p.title, p.difficulty, p.submit_count, p.pass_rate,
    GROUP_CONCAT(t.name) AS tags
FROM problem p
LEFT JOIN problem_tag pt ON p.id = pt.problem_id
LEFT JOIN tag t ON pt.tag_id = t.id
WHERE p.status = 1
GROUP BY p.id
ORDER BY p.id
LIMIT 20;
```

------

### 2. é¢˜ç›®è¯¦æƒ…é¡µï¼ˆå«æ˜¯å¦å¯çœ‹ç­”æ¡ˆï¼‰

sqlæ·±è‰²ç‰ˆæœ¬

```
-- æŸ¥è¯¢é¢˜ç›®
SELECT * FROM problem WHERE id = ?;

-- æŸ¥è¯¢ç”¨æˆ·æ˜¯å¦å·²é€šè¿‡ï¼ˆå†³å®šæ˜¯å¦æ˜¾ç¤ºâ€œæŸ¥çœ‹ç­”æ¡ˆâ€æŒ‰é’®ï¼‰
SELECT COUNT(*) FROM submission 
WHERE user_id = ? AND problem_id = ? AND status = 1;
```

------

### 3. æŸ¥çœ‹æŸé¢˜çš„æ‰€æœ‰æäº¤è®°å½•ï¼ˆç”¨æˆ·è§†è§’ï¼‰

sqlæ·±è‰²ç‰ˆæœ¬

```
SELECT id, language, status, submit_time, run_time_ms, memory_kb, score
FROM submission
WHERE user_id = ? AND problem_id = ?
ORDER BY submit_time DESC;
```

------

### 4. æŸ¥çœ‹æŸæ¬¡æäº¤çš„è¯¦ç»†æµ‹è¯•ç»“æœ

sqlæ·±è‰²ç‰ˆæœ¬

```
SELECT test_case_name, status, run_time_ms, memory_kb
FROM submission_detail
WHERE submission_id = ?
ORDER BY order_index;
```

------

## äº”ã€å®‰å…¨ä¸æƒé™å»ºè®®

| èµ„æº                        | è®¿é—®æ§åˆ¶                                                     |
| --------------------------- | ------------------------------------------------------------ |
| `in_url`, `out_url`         | ä»…åç«¯åˆ¤é¢˜æœåŠ¡å¯è®¿é—®ï¼Œ**ä¸æš´éœ²ç»™å‰ç«¯**                       |
| `problem_answer.answer_url` | ä»…å½“ `user_problem_status.last_status = 2`ï¼ˆå·²é€šè¿‡ï¼‰æ—¶å¯æŸ¥çœ‹ |
| `submission.code_url`       | ä»…æäº¤è€…å’Œç®¡ç†å‘˜å¯æŸ¥çœ‹                                       |
| `submission_detail`         | ä»…æäº¤è€…å¯æŸ¥çœ‹è¯¦ç»†æµ‹è¯•è¾“å‡ºï¼ˆé˜²ä½œå¼Šï¼‰                         |

------

## å…­ã€æ€»ç»“ï¼šæœ€ç»ˆè¡¨ç»“æ„æ¸…å•

| è¡¨å                  | ç”¨é€”                               |
| --------------------- | ---------------------------------- |
| `problem`             | é¢˜ç›®å…ƒä¿¡æ¯ + ç»Ÿè®¡                  |
| `tag`                 | æ ‡ç­¾å®šä¹‰                           |
| `problem_tag`         | é¢˜ç›®-æ ‡ç­¾å¤šå¯¹å¤šå…³è”                |
| `submission`          | ç”¨æˆ·æäº¤è®°å½•ï¼ˆæ€»è§ˆï¼‰               |
| `submission_detail`   | æ¯ä¸ªæµ‹è¯•ç‚¹çš„åˆ¤é¢˜ç»“æœ               |
| `problem_answer`      | é¢˜ç›®å‚è€ƒç­”æ¡ˆï¼ˆæƒé™æ§åˆ¶ï¼‰           |
| `user_problem_status` | ç”¨æˆ·é¢˜ç›®çŠ¶æ€å¿«ç…§ï¼ˆå¯é€‰ï¼Œæå‡æ€§èƒ½ï¼‰ |

## âœ… ä¸‹ä¸€æ­¥å»ºè®®

1. **åˆ¤é¢˜æœåŠ¡è§£è€¦**ï¼šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ RabbitMQ/Kafkaï¼‰å¼‚æ­¥å¤„ç†æäº¤ï¼Œé¿å…é˜»å¡ã€‚
2. **ä»£ç å­˜å‚¨å®‰å…¨**ï¼š`code_url` å’Œ `answer_url` ä½¿ç”¨ä¸´æ—¶ç­¾åé“¾æ¥ï¼ˆå¦‚ OSS Presigned URLï¼‰ï¼Œé˜²æ­¢æœªæˆæƒè®¿é—®ã€‚
3. **ç¼“å­˜ç­–ç•¥**ï¼šRedis ç¼“å­˜çƒ­é—¨é¢˜ç›®çš„æ ‡ç­¾ã€é€šè¿‡ç‡ç­‰ã€‚
4. **åˆ†é¡µä¼˜åŒ–**ï¼š`submission` è¡¨æŒ‰ `user_id + submit_time` åˆ†é¡µæŸ¥è¯¢ã€‚
